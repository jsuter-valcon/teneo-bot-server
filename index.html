<html>
 <head>
  <meta charset="UTF-8">
<script src="teneo-web-chat.js"></script>
<script src="customer-sdk.js"></script>  
<script src="lc-extensions.js"></script>  
<script>

 /*! For license information please see teneo-web-chat.js.LICENSE.txt */
const cookieName = 'myFirstSessionIdentifier';
	
 window.onload = function () {
    watch_for_chat();
    if (
      window.TeneoWebChat &&
        typeof window.TeneoWebChat.initialize === 'function'
    ) {
      var element = document.getElementById('teneo-web-chat');
      var cookieCheck = getCookie(cookieName);
      console.log("cookieCheck1", cookieCheck);	    
      var teneoProps = {
        'teneoEngineUrl': 'https://skilledmacaws-83ad8d.bots.teneo.ai/valcon_website_bot_7nktpvvsph8n0sdxe8yxsbzv2h/',
        'channel':'valcon',
	 'teneoEngineParams': {
        demo:'valcon', 
        channel:'valcon',
        botname:'Valerie',
        prevSession:`${cookieCheck}`
        },      
        'title':'Speak with virtual agent Valerie',
        'autoRedirect':false,
        'showCloseButton':true,
        'first_use_asr_system_message':'',
        'showAsrButton':true,
        'showTtsButton':true,
        'botAvatarUrl':'https://avj-images.s3.eu-west-2.amazonaws.com/valconlogo.png',
        'msVoice':'en-GB-OliviaNeural',
        'msCognitiveSubscriptionKey':'e80f77176d1349709e6d237bbe3d476d',
        'msCognitiveRegion':'uksouth'
      }
      window.TeneoWebChat.initialize(element,teneoProps);
      
    }
  }

function getCookie(name) {
  const value = `; ${document.cookie}`;
  //console.log("cookie values: ", value);	
  const parts = value.split(`; ${name}=`);
  if (parts.length === 2) return parts.pop().split(';').shift();
}		
	
 function onEngineResponse(payload) {
	// handle engine response event
    var response = payload.responseDetails;

    if(response.output.parameters.msVoice && response.output.parameters.msVoice!="") {
    	TeneoWebChat.call('set_ms_voice', response.output.parameters.msVoice );
    	TeneoWebChat.call('set_locale',response.output.parameters.locale );
        console.log("voice", response.output.parameters.msVoice); 	    
        console.log("locale", response.output.parameters.locale);
    }
    var sessionId = response.sessionId;
    
    var cookieCheck = `${getCookie(cookieName)}`;
    console.log("cookieCheck", cookieCheck);
    if(cookieCheck===undefined || cookieCheck==='undefined' || cookieCheck=='undefined') {
    	document.cookie='myFirstSessionIdentifier=' + sessionId + '; Max-Age=1707109200';
	console.log("cookieCreated", sessionId);    
    }
    /*else {
	if(!cookieCheck.includes(sessionId)) {
		document.cookie='previousSessionIds=' + sessionId + '-'+cookieCheck+'; Max-Age=1707109200';
	}
    }*/
}

TeneoWebChat.on('engine_response', onEngineResponse);
 
  window.TENEOCTX || (TENEOCTX = {});
  TENEOCTX = {
    init: {
      trustedDomain: "", // something like http://localhost:8080 // "" = receive and post messages to all domains
      allowScripts: true // false = if you want to disable potential eval
    },
    ctx: {
      eventSource: "leopard-embed",
      pageTitle: document.title,
      pageUrl: window.location.href,
      pageTopic: "Help",
      message: "This was sent from the customer's web site"
    }
  };
</script>  
<script>
 

const resize_spec = '* 1.5';
 
function find_node( path, context )
{
     var found = document.evaluate( path, context, null,
                                    XPathResult.ANY_UNORDERED_NODE_TYPE, null );
     return ( found && found.singleNodeValue ) ? found.singleNodeValue : null;
}

function watch_for_chat ()
{
    const sentinel2 = function(mutants, observer)
    {
        for( const mutant of mutants )
        {
            var found = false;
            if (mutant.type != 'childList')
                 continue;

            var added = mutant.addedNodes;
            for (let i = 0; i < added.length; i++)
            {
                if( added[i].id == 'twc-chat-window' )
                    found = added[i];
                else
                    found = find_node( "//*[@id='twc-chat-window']", added[i] );

                if( found )
                {
                    var width;
                    var style = window.getComputedStyle( found );
                    //width = 'calc( ' + style.width + ' ' + resize_spec + ' )';
                    width='40%';
                    found.style['min-height'] = '95%';
                    found.style.width = width;
                    break;
                }
            }
        }    
    };

    const sentinel1 = function(mutants, observer)
    {
        for( const mutant of mutants )
        {
            var found = false;
            if (mutant.type != 'childList')
                 continue;

            var added = mutant.addedNodes;
            for (let i = 0; i < added.length; i++)
            {
                if( added[i].id == 'twc-launchbutton' )
                    found = added[i];
                else
                    found = find_node( "//*[@id='twc-launchbutton']", added[i] );

                if( found )
                {
                    observer.disconnect();
                    found.click();
                    break;
                }
           }
        }
    };

    const target   = document.getElementsByTagName('body')[0];
    const config   = { attributes: false, childList: true, subtree: true };; 
 
    if( target )
    {
         const open = new MutationObserver( sentinel1 );
         const wide = new MutationObserver( sentinel2 )
         if( open )
             open.observe( target, config );
         if( wide )
             wide.observe( target, config );
    }
}
  </script>
  <style>
 .teneo-web-chat {
  --primary-color: #000000 !important;
  --light-bg-color: #ee5743 !important;
  --launch-button-bg-color: #000000 !important;
  --header-bg-color: #000000 !important;
  --bot-message-fg-color: #ffffff !important;
  --card-bg-color: #a3818a !important;
  --form-subtitle-text-color: #000000 !important;
  --dark-fg-color: #000000 !important;
  --success-color: #a3818a !important;
  --danger-color: #ee5743 !important;
  --secondary-color: #333333 !important;
  --text-link-color: #E6E6E6 !important;
  --link-button-bg-color: #000000 !important;
} 
// button drop shadow
.twc-launch-button:hover {
  box-shadow: 0 0px 27px 1.5px rgba(0, 0, 0, 0.2);
}

// increase size of the icon slightly
.twc-launch-button:hover .twc-launch-button__open-icon {
  transform: scale(1.5);
}   
</style>
 </head>
    <body>
<!-- Teneo Web Chat end -->
    
<iframe src="https://valcon.com/conversational-ai/" title="Valcon" width="100%" height="100%"></iframe>    

<!-- Teneo Web Chat start -->
<div id="teneo-web-chat"></div>
<!--div id="leopardChatWindow"></div>
<script src="https://afs-customer-services.herokuapp.com/embed-leopard.js"></script-->
    </body>
</html>
